extends layout

block content
  script.
      $(document).ready(function () {
          function format_unixtime(unixtime) {
              var a = new Date(unixtime * 1000);
              var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
              var year = a.getFullYear();
              var month = months[a.getMonth()];
              var date = a.getDate();
              var hour = a.getHours();
              var min = a.getMinutes();
              var sec = a.getSeconds();
              var suffix = 'th'
              if (date == 1 || date == 21 || date == 31)
                  suffix = 'st';
              if (date == 2 || date == 22 || date == 32)
                  suffix = 'nd';
              if (date == 3 || date == 23)
                  suffix = 'rd';
              if (hour < 10)
                  hour = '0' + hour;
              if (min < 10)
                  min = '0' + min;
              if (sec < 10)
                  sec = '0' + sec;
              var time = date + suffix + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
              return time;
          }
          var rtable = $('.table-custom').dataTable({
              autoWidth: true,
              searching: false,
              ordering: false,
              //responsive: true,
              lengthChange: true,
              processing: true,
              bDestroy: true,
              pageLength: 10,
              serverSide: true,
              language: {
                  paginate: {
                      next: '<i class="fa fa-fw fa-chevron-right">',
                      previous: '<i class="fa fa-fw fa-chevron-left">'
                  }
              },
              dom: "<'row'<'col-sm-12' <'wrap' <'table-custom-header'> l>>>" +
              "<'row'<'col-sm-12'tr>>" +
              "<'row'<'col-sm-5'i><'col-sm-7'p>>",
              ajax: {
                  url: '/ext/getAddressTxs',
                  type: 'POST',
                  data: {
                      hash: "#{address.a_id}",
                  },
                  dataSrc: function (json) {
                      for (var i = 0; i < json.data.length; i++) {
                          json.data[i]['timestamp'] = '<span class="hidden-xs">' + format_unixtime(json.data[i]['timestamp']) + '</span>';
                          json.data[i]['txid'] = "<a href='/tx/" + json.data[i]['txid'] + "'>" +
                              '<span class="hidden-xs">' +  json.data[i]['txid'] + '</span>' +
                              '<span class="visible-xs">' +  json.data[i]['txid'].substr(0, 30) + '...' + '</span>' +
                              "</a>";
                          var out = 0
                          var vin = 0
                          for (var r in json.data[i].vout) {
                              if (json.data[i].vout[r].addresses === "#{address.a_id}") {
                                  out = json.data[i].vout[r].amount
                              }
                          }
                          for (var s in json.data[i].vin) {
                              if (json.data[i].vin[s].addresses === "#{address.a_id}") {
                                  vin = json.data[i].vin[s].amount
                              }
                          }
                          if (out > 0 && vin > 0) {
                              var amount = (out - vin) / 100000000;
                              if (amount < 0) {
                                  amount = amount * -1;
                                  amount = amount.toFixed(8);
                              }
                          } else if (out > 0) {
                              amount = out / 100000000;
                          } else {
                              amount = vin / 100000000;
                          }
                          amount = amount.toFixed(8);
                          json.data[i]['amount'] = amount;
                          json.data[i]['out'] = out;
                          json.data[i]['vin'] = vin;
                      }
                      return json.data;
                  }
              },
              columns: [
                  {data: 'timestamp', width: '20%', className: "hidden-xs"},
                  {data: 'txid', width: '60%'},
                  {data: 'amount', width: '20%'},
                  //{data: 'lastpaid', width: '15%'},
                  //{data: 'activetime', width: '15%'},
              ],
              "createdRow": function (row, data, dataIndex) {
                  if (data.out > 0 && data.vin > 0) {
                      $(row).children(':nth-child(3)').addClass('info');
                  } else if (data.out > 0) {
                      $(row).children(':nth-child(3)').addClass('success');
                  } else {
                      $(row).children(':nth-child(3)').addClass('danger');
                  }
              }
          })

          $("div.table-custom-header").html("#{settings.locale.ex_latest_transactions}");
      })

  - var balance = (address.received - address.sent) / 100000000;
  - var sent = address.sent /100000000
  - var received = address.received / 100000000
    img.qrcode.pull-right.hidden-md.hidden-sm.hidden-xs(src='/qr/#{address.a_id}')
  .col-xs-12.col-md-12.col-lg-10.col-lg-offset-1
    .panel.panel-default.panel-address-summary.my-panel
      .panel-heading(style='position:relative;')
        if settings.labels[address.a_id]
          strong(class='#{settings.labels[address.a_id].class}') #{address.a_id}
        else
          strong #{address.a_id}
        if settings.labels[address.a_id]
          if settings.labels[address.a_id].type  
            label(class='label label-#{settings.labels[address.a_id].type} pull-right hidden-xs', style='margin-left:15px;')
              =settings.labels[address.a_id].label
              if settings.labels[address.a_id].url
                a(href='#{settings.labels[address.a_id].url}', target='_blank')
                  span.fa.fa-question-circle(style='margin-left:5px;')
          else
            label.label.label-default.pull-right.hidden-xs(style='margin-left:15px;') 
              =settings.labels[address.a_id].label
              if settings.labels[address.a_id].url
                a(href='#{settings.labels[address.a_id].url}', target='_blank')
                  span.fa.fa-question-circle(style='margin-left:5px;')
      table.table.table-bordered.table-striped.summary-table 
        thead
          tr
            if settings.show_sent_received == true
              th #{settings.locale.total_sent} (#{settings.symbol})
            if address.a_id !== 'coinbase'
              if settings.show_sent_received == true
                th #{settings.locale.total_received} (#{settings.symbol})
              th #{settings.locale.rl_balance} (#{settings.symbol})
        tbody             
          tr
            if settings.show_sent_received == true 
              td #{sent.toFixed(8)}
            if address.a_id !== 'coinbase'
              if settings.show_sent_received == true
                td #{received.toFixed(8)}
              td #{balance.toFixed(8)}
    .panel.panel-default.my-panel
      table.table.table-bordered.table-striped.history-table.table-custom
          thead
              tr
                  th.hidden-xs #{settings.locale.timestamp}
                  th #{settings.locale.tx_hash}
                  th #{settings.locale.mkt_amount} (#{settings.symbol})
          tbody
    //    include ./includes/address_history.jade
    //.panel.panel-default.hidden-lg.hidden-md.my-panel
    //  table.table.table-bordered.table-striped.table-custom
    //    include ./includes/address_history.jade
    .footer-padding
            